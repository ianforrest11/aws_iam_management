name: Terraform Workflow

on:
  push:
    branches:
      - main  # Trigger on push to the main branch

jobs:
  terraform:
    name: Run Terraform
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
        
      # Iterate through each Terraform directory
      - name: Iterate through directories
        id: iterate-directories
        run: |
          for dir in $(find . -type d -name 'terraform'); do
            cd $dir
            echo "Entering directory $dir"
            
            # Initialize Terraform
            terraform init

            # Validate Terraform configuration
            terraform validate

            # Plan Terraform changes
            terraform plan -var-file=../variables/terraform.tfvars
            
            # Apply Terraform changes (auto-approve for automation)
            terraform apply -auto-approve -var-file=../variables/terraform.tfvars
            
            cd ..
          done

